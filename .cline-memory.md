# GLM 4.7 Project Memory System

**Purpose**: Persistent knowledge base for GLM 4.7 to remember project evolution, decisions, and context across sessions.

---

## Session Context

**Project**: Warehouse Management System (WMS)
**Last Updated**: 2025-01-19
**Active Branch**: main (typically)
**Environment**: Development

---

## Recent Decisions (Last 30 Days)

### 2025-01-19: Enhanced GLM 4.7 Context System
- **Decision**: Added project index, decision log, and quick reference for AI
- **Rationale**: Improve GLM 4.7's understanding of project structure and intent
- **Impact**: Faster context loading, better decision-making
- **Files Added**:
  - `.project-index.json` - Fast project navigation
  - `docs/DECISIONS.md` - Architectural decision log
  - `docs/QUICK_REFERENCE.md` - GLM 4.7 quick reference

### 2025-01-12: Supreme Ruleset for GLM 4.7
- **Decision**: Enhanced `.clinerules.md` to 2,494 lines with comprehensive protocols
- **Rationale**: Give GLM 4.7 Claude-like cognitive capabilities
- **Impact**: Better code quality, more consistent patterns
- **Key Features**:
  - Six-thinking-hats protocol
  - Self-healing system
  - Pattern extraction and search
  - Auto-test generation

---

## Technical Debt Log

| ID | Description | Impact | Priority | Planned Fix |
|----|-------------|--------|----------|-------------|
| TD-001 | Need WebSocket implementation for real-time dashboard | Medium | High | Q1 2025 |
| TD-002 | Add Redis caching layer for SKU/user lookups | Medium | Medium | Q1 2025 |
| TD-003 | E2E tests not implemented | High | High | Q2 2025 |
| TD-004 | Packing module incomplete | High | Critical | ASAP |
| TD-005 | Performance monitoring not in place | Medium | Low | Q2 2025 |
| TD-006 | Documentation needs screenshots | Low | Low | Ongoing |

---

## Domain Knowledge Base

### Business Rules (Critical)
1. **Order fulfillment flow**: Orders must follow strict state machine
2. **Inventory integrity**: Can never go negative; reservations prevent overselling
3. **Picker limits**: Max 10 active orders per picker
4. **Packer limits**: Max 5 active orders per packer
5. **Audit requirements**: All state changes must be logged (legal requirement)

### Integration Points
- **PostgreSQL**: Primary data store (localhost:5432)
- **Redis**: Planned for caching (not yet implemented)
- **External APIs**: None currently (planned for shipping carriers)

### Performance Characteristics
- **Bottleneck identified**: Dashboard metrics queries (pending optimization)
- **N+1 query pattern**: Found and fixed in order listing
- **Connection pool**: Set to max 20 connections (may need tuning)
- **Hot path**: Order claiming during peak hours (needs monitoring)

---

## Common Patterns & Anti-Patterns

### What Works (Use These)
✅ **Service layer transactions** - All multi-step operations wrapped
✅ **Enum imports from shared** - No string literals for status/roles
✅ **Result type for errors** - Explicit error handling
✅ **Zod/Joi validation** - Input validation on all endpoints
✅ **React Query for server state** - Automatic caching and refetching
✅ **Soft delete** - Never hard delete user data

### What Doesn't (Avoid These)
❌ **Business logic in frontend** - Keep in backend services
❌ **Skipping transactions** - Causes data corruption
❌ **String literals for enums** - Typos cause runtime bugs
❌ **Direct database access in controllers** - Use repositories
❌ **Permanent user actions** - Everything must be reversible

---

## Known Issues & Workarounds

### Current Issues
1. **Port conflicts on Windows**
   - **Symptom**: "Port already in use" errors
   - **Workaround**: Use `npm run dev:restart` (kills all processes)

2. **Database migration failures**
   - **Symptom**: Migrations don't apply
   - **Workaround**: Drop and recreate database (use `npm run db reset`)

3. **Test flakiness in CI**
   - **Symptom**: Tests pass locally but fail in CI
   - **Workaround**: Increase test timeouts; check database isolation

4. **Memory leaks in dev mode**
   - **Symptom**: Slowdown over time
   - **Workaround**: Restart dev servers periodically

### Fixed Issues (Historical)
- ~~Race conditions in inventory reservation~~ (Fixed with SELECT FOR UPDATE)
- ~~Type drift between frontend/backend~~ (Fixed with shared types)
- ~~Order state corruption~~ (Fixed with transaction enforcement)
- ~~Dropped connections during hot reload~~ (Fixed with graceful shutdown)

---

## Performance Benchmarks

### Current Baseline (January 2025)
- **API response time**: ~100ms average (p95: 500ms)
- **Database query time**: ~50ms average (p95: 200ms)
- **Frontend load time**: ~2s initial, ~500ms subsequent
- **Test suite runtime**: ~30 seconds for full suite

### Performance Goals
- **API response**: < 100ms p95
- **Database query**: < 100ms p95
- **Frontend load**: < 1s initial
- **Test suite**: < 60 seconds

---

## Team Preferences

### Code Style
- **Indentation**: 2 spaces (no tabs)
- **Quotes**: Single quotes for strings, double for JSX
- **Naming**: camelCase for variables/functions, PascalCase for types/classes
- **File naming**: kebab-case for files
- **Line length**: Prefer < 100 characters, soft limit at 120

### Communication Style
- **Prefer**: Direct, concise responses
- **When learning**: Detailed explanations with examples
- **When blocked**: Immediate help with root cause
- **When exploring**: Multiple options with trade-offs

### Development Workflow
- **Branch strategy**: Feature branches from main
- **Commit style**: Conventional commits (feat/fix/docs/refactor)
- **Review process**: Self-review before commit; AI-assisted review preferred
- **Testing**: Tests before commit (enforced by pre-commit hook)

---

## Learning & Adaptations

### What GLM 4.7 Has Learned
1. **Transaction enforcement** - Critical for data integrity
2. **Pattern reuse** - Extracting patterns saves time
3. **Undo support** - Essential for good UX
4. **Type safety** - Prevents many runtime bugs
5. **Incremental development** - Small changes are safer

### Patterns to Remember
1. **Service layer pattern** - Business logic in services
2. **Repository pattern** - Data access abstraction
3. **State machine pattern** - Controlled state transitions
4. **Observer pattern** - Dashboard updates (future: WebSocket)
5. **Strategy pattern** - Different handling by role/context

### Common Pitfalls to Avoid
1. **Skipping tests** - Always slows you down later
2. **Premature optimization** - Measure first, then optimize
3. **Over-engineering** - Keep it simple until proven necessary
4. **Ignoring errors** - Always handle errors properly
5. **Forgetting undo** - Users will make mistakes

---

## Quick Wins for Future Sessions

When starting a new session, GLM 4.7 should:
1. ✅ Read `.project-index.json` for fast context
2. ✅ Check `docs/QUICK_REFERENCE.md` for user intent patterns
3. ✅ Review recent decisions in `docs/DECISIONS.md`
4. ✅ Check technical debt for priorities
5. ✅ Verify current branch and recent changes

---

## Session Goals

### Current Focus (January 2025)
- [x] Implement AI-optimized development workflow
- [ ] Complete packing module implementation
- [ ] Add WebSocket for real-time updates
- [ ] Implement Redis caching layer
- [ ] Add comprehensive E2E tests
- [ ] Performance optimization for dashboard

### Next Session Priorities
1. **Packing module** - Complete packer interface
2. **Real-time updates** - WebSocket implementation
3. **Performance** - Dashboard query optimization
4. **Testing** - E2E test suite
5. **Documentation** - API documentation with Swagger

---

## Feedback Loop

### What Works Well
- Comprehensive ruleset guides GLM 4.7 effectively
- Pattern library speeds up development
- MCP tools for test generation are helpful
- Transaction enforcement prevents bugs

### What Could Be Better
- Context loading could be faster (need progressive loading)
- Pattern search could be more semantic
- Need better error recovery when things break
- Would benefit from code graph understanding

### Continuous Improvement
- Extract patterns after every non-trivial task
- Update decision log when making architectural choices
- Document new patterns as they emerge
- Refine rules based on what works/doesn't

---

## Meta-Information

**Memory System Version**: 1.0.0
**Last Updated**: 2025-01-19
**Update Frequency**: After each significant session or decision
**Maintained By**: GLM 4.7 with human oversight

**How to Update**:
- Add new decisions to "Recent Decisions" section
- Log technical debt as discovered
- Update domain knowledge when learning new business rules
- Add patterns that work well to "What Works"
- Document issues and workarounds as encountered

---

**This file is the collective memory of GLM 4.7's work on this project. It compounds over time, making each session more productive than the last.**
